<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="5129px" preserveAspectRatio="none" style="width:2473px;height:5129px;" version="1.1" viewBox="0 0 2473 5129" width="2473px" zoomAndPan="magnify"><defs><filter height="300%" id="f12jdmkq7tu2br" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#D3D3D3" height="5114.6406" style="stroke: #383838; stroke-width: 1.0;" width="727" x="1003" y="4"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="182" x="1275.5" y="26.8379">Payment Manager</text><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="125.0156" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1061" y="292.7031"/><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="208.3594" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1061" y="767.7656"/><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="125.0156" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1061" y="1345.1719"/><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="179.6875" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1061" y="1759.8906"/><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="96.3438" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1061" y="2120.2656"/><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="96.3438" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1061" y="2557.9844"/><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="651.0938" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1061" y="2916.3594"/><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="96.3438" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1061" y="3740.1406"/><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="179.6875" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1061" y="4177.8594"/><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="155.3594" style="stroke: #000000; stroke-width: 2.0;" width="925" x="210" y="432.7188"/><rect fill="#FFFFFF" height="71.3438" style="stroke: none; stroke-width: 1.0;" width="925" x="210" y="516.7344"/><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="587.4219" style="stroke: #000000; stroke-width: 2.0;" width="1928" x="477" y="2973.0313"/><rect fill="#FFFFFF" height="407.0625" style="stroke: none; stroke-width: 1.0;" width="1928" x="477" y="3153.3906"/><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="500.7344" style="stroke: #000000; stroke-width: 2.0;" width="2241" x="210" y="4523.5625"/><rect fill="#FFFFFF" height="209.3594" style="stroke: none; stroke-width: 1.0;" width="2241" x="210" y="4814.9375"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="274" x2="274" y1="110.0156" y2="5041.2969"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1066" x2="1066" y1="110.0156" y2="5041.2969"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1667" x2="1667" y1="110.0156" y2="5041.2969"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2113.5" x2="2113.5" y1="110.0156" y2="5041.2969"/><rect fill="#F8F8F8" filter="url(#f12jdmkq7tu2br)" height="69.3438" style="stroke: #383838; stroke-width: 1.5;" width="104" x="220" y="35.6719"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="90" x="227" y="65.5098">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="63" x="240.5" y="93.1816">Switch</text><rect fill="#F8F8F8" filter="url(#f12jdmkq7tu2br)" height="69.3438" style="stroke: #383838; stroke-width: 1.5;" width="104" x="220" y="5040.2969"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="90" x="227" y="5070.1348">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="63" x="240.5" y="5097.8066">Switch</text><rect fill="#F8F8F8" filter="url(#f12jdmkq7tu2br)" height="69.3438" style="stroke: #383838; stroke-width: 1.5;" width="114" x="1007" y="35.6719"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="90" x="1019" y="65.5098">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="100" x="1014" y="93.1816">Connector</text><rect fill="#F8F8F8" filter="url(#f12jdmkq7tu2br)" height="69.3438" style="stroke: #383838; stroke-width: 1.5;" width="114" x="1007" y="5040.2969"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="90" x="1019" y="5070.1348">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="100" x="1014" y="5097.8066">Connector</text><rect fill="#F8F8F8" filter="url(#f12jdmkq7tu2br)" height="69.3438" style="stroke: #383838; stroke-width: 1.5;" width="114" x="1608" y="35.6719"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="48" x="1641" y="65.5098">Core</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="100" x="1615" y="93.1816">Connector</text><rect fill="#F8F8F8" filter="url(#f12jdmkq7tu2br)" height="69.3438" style="stroke: #383838; stroke-width: 1.5;" width="114" x="1608" y="5040.2969"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="48" x="1641" y="5070.1348">Core</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="100" x="1615" y="5097.8066">Connector</text><rect fill="#F8F8F8" filter="url(#f12jdmkq7tu2br)" height="41.6719" style="stroke: #383838; stroke-width: 1.5;" width="221" x="2001.5" y="63.3438"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="207" x="2008.5" y="93.1816">Core banking solution</text><rect fill="#F8F8F8" filter="url(#f12jdmkq7tu2br)" height="41.6719" style="stroke: #383838; stroke-width: 1.5;" width="221" x="2001.5" y="5040.2969"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="207" x="2008.5" y="5070.1348">Core banking solution</text><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="125.0156" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1061" y="292.7031"/><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="208.3594" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1061" y="767.7656"/><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="125.0156" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1061" y="1345.1719"/><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="179.6875" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1061" y="1759.8906"/><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="96.3438" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1061" y="2120.2656"/><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="96.3438" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1061" y="2557.9844"/><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="651.0938" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1061" y="2916.3594"/><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="96.3438" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1061" y="3740.1406"/><rect fill="#FFFFFF" filter="url(#f12jdmkq7tu2br)" height="179.6875" style="stroke: #383838; stroke-width: 1.0;" width="10" x="1061" y="4177.8594"/><rect fill="#EEEEEE" filter="url(#f12jdmkq7tu2br)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2458" x="3" y="146.8516"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2461" y1="146.8516" y2="146.8516"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2461" y1="149.8516" y2="149.8516"/><rect fill="#EEEEEE" filter="url(#f12jdmkq7tu2br)" height="35.6719" style="stroke: #000000; stroke-width: 2.0;" width="382" x="1041" y="130.0156"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="362" x="1047" y="156.8535">Payee DFSP integration - Discovery</text><polygon fill="#383838" points="1054,205.3594,1064,209.3594,1054,213.3594,1058,209.3594" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="1060" y1="209.3594" y2="209.3594"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="281" y="202.5254">[1]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="47" x="311" y="202.5254">GET</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="87" x="364" y="202.5254">/getParty</text><polygon fill="#383838" points="285,247.0313,275,251.0313,285,255.0313,281,251.0313" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="279" x2="1065" y1="251.0313" y2="251.0313"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="291" y="244.1973">[2]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="205" x="321" y="244.1973">HTTP 202 Response</text><polygon fill="#383838" points="1655,288.7031,1665,292.7031,1655,296.7031,1659,292.7031" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1071" x2="1661" y1="292.7031" y2="292.7031"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1078" y="285.8691">[3]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="47" x="1108" y="285.8691">GET</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="87" x="1161" y="285.8691">/getParty</text><polygon fill="#383838" points="2102,330.375,2112,334.375,2102,338.375,2106,334.375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1667" x2="2108" y1="334.375" y2="334.375"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1674" y="327.541">[4]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="47" x="1704" y="327.541">GET</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="156" x="1757" y="327.541">[account lookup]</text><polygon fill="#383838" points="1678,372.0469,1668,376.0469,1678,380.0469,1674,376.0469" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1672" x2="2113" y1="376.0469" y2="376.0469"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1684" y="369.2129">[5]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="98" x="1714" y="369.2129">Response</text><polygon fill="#383838" points="1077,413.7188,1067,417.7188,1077,421.7188,1073,417.7188" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1071" x2="1666" y1="417.7188" y2="417.7188"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1083" y="410.8848">[6]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="98" x="1113" y="410.8848">Response</text><path d="M210,432.7188 L279,432.7188 L279,451.7188 L269,461.7188 L210,461.7188 L210,432.7188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="155.3594" style="stroke: #000000; stroke-width: 2.0;" width="925" x="210" y="432.7188"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="225" y="456.5566">alt</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="221" x="294" y="457.5566">[If Success response]</text><polygon fill="#383838" points="285,504.7344,275,508.7344,285,512.7344,281,508.7344" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="279" x2="1065" y1="508.7344" y2="508.7344"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="291" y="501.9004">[7]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="321" y="501.9004">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="478" x="373" y="501.9004">/parties/{Type}/{Id} (or /parties/{Type}/{Id}/{SubId})</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="210" x2="1135" y1="517.7344" y2="517.7344"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="185" x="215" y="540.5723">[if Error response]</text><polygon fill="#383838" points="285,576.0781,275,580.0781,285,584.0781,281,580.0781" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="279" x2="1065" y1="580.0781" y2="580.0781"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="291" y="573.2441">[8]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="321" y="573.2441">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="582" x="373" y="573.2441">/parties/{Type}/{Id}/error (or /parties/{Type}/{Id}/{SubId}/error)</text><rect fill="#EEEEEE" filter="url(#f12jdmkq7tu2br)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2458" x="3" y="621.9141"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2461" y1="621.9141" y2="621.9141"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2461" y1="624.9141" y2="624.9141"/><rect fill="#EEEEEE" filter="url(#f12jdmkq7tu2br)" height="35.6719" style="stroke: #000000; stroke-width: 2.0;" width="880" x="792" y="605.0781"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="860" x="798" y="631.916">Payee DFSP integration - Quote and Transfer - 2 phase commit with prior AML check</text><polygon fill="#383838" points="1054,680.4219,1064,684.4219,1054,688.4219,1058,684.4219" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="1060" y1="684.4219" y2="684.4219"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="281" y="677.5879">[9]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="311" y="677.5879">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="71" x="379" y="677.5879">/quotes</text><polygon fill="#383838" points="285,722.0938,275,726.0938,285,730.0938,281,726.0938" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="279" x2="1065" y1="726.0938" y2="726.0938"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="291" y="719.2598">[10]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="205" x="333" y="719.2598">HTTP 202 Response</text><polygon fill="#383838" points="1655,763.7656,1665,767.7656,1655,771.7656,1659,767.7656" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1071" x2="1661" y1="767.7656" y2="767.7656"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1078" y="760.9316">[11]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="1120" y="760.9316">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="131" x="1188" y="760.9316">/quoterequest</text><polygon fill="#383838" points="2102,805.4375,2112,809.4375,2102,813.4375,2106,809.4375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1667" x2="2108" y1="809.4375" y2="809.4375"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1674" y="802.6035">[12]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="1716" y="802.6035">AML</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="212" x="1767" y="802.6035">checks (velocity,etc...)</text><polygon fill="#383838" points="1678,847.1094,1668,851.1094,1678,855.1094,1674,851.1094" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1672" x2="2113" y1="851.1094" y2="851.1094"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1684" y="844.2754">[13]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="98" x="1726" y="844.2754">Response</text><polygon fill="#383838" points="2102,888.7813,2112,892.7813,2102,896.7813,2106,892.7813" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1667" x2="2108" y1="892.7813" y2="892.7813"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1674" y="885.9473">[14]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="1716" y="885.9473">Calculate Fees</text><polygon fill="#383838" points="1678,930.4531,1668,934.4531,1678,938.4531,1674,934.4531" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1672" x2="2113" y1="934.4531" y2="934.4531"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1684" y="927.6191">[15]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="98" x="1726" y="927.6191">Response</text><polygon fill="#383838" points="1077,972.125,1067,976.125,1077,980.125,1073,976.125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1071" x2="1666" y1="976.125" y2="976.125"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1083" y="969.291">[16]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="98" x="1125" y="969.291">Response</text><polygon fill="#383838" points="285,1013.7969,275,1017.7969,285,1021.7969,281,1017.7969" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="279" x2="1065" y1="1017.7969" y2="1017.7969"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="291" y="1010.9629">[17]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="333" y="1010.9629">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="109" x="385" y="1010.9629">/quotes/{Id}</text><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="316" y1="1085.6406" y2="1085.6406"/><line style="stroke: #383838; stroke-width: 1.0;" x1="316" x2="316" y1="1085.6406" y2="1098.6406"/><line style="stroke: #383838; stroke-width: 1.0;" x1="275" x2="316" y1="1098.6406" y2="1098.6406"/><polygon fill="#383838" points="285,1094.6406,275,1098.6406,285,1102.6406,281,1098.6406" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="1078.8066">[18]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="202" x="323" y="1078.8066">Pass Quote to Payer</text><path d="M8,1030.7969 L8,1123.7969 L265,1123.7969 L265,1040.7969 L255,1030.7969 L8,1030.7969 " fill="#ECECEC" filter="url(#f12jdmkq7tu2br)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M255,1030.7969 L255,1040.7969 L265,1040.7969 L255,1030.7969 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="169" x="14" y="1058.6348">Obtain consent to</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="236" x="14" y="1086.3066">proceed with the transfer</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="32" x="14" y="1113.9785">Via</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="52" y="1113.9785">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="90" x="120" y="1113.9785">/transfers</text><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="316" y1="1166.4844" y2="1166.4844"/><line style="stroke: #383838; stroke-width: 1.0;" x1="316" x2="316" y1="1166.4844" y2="1179.4844"/><line style="stroke: #383838; stroke-width: 1.0;" x1="275" x2="316" y1="1179.4844" y2="1179.4844"/><polygon fill="#383838" points="285,1175.4844,275,1179.4844,285,1183.4844,281,1179.4844" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="1159.6504">[19]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="273" x="323" y="1159.6504">Perform liquidity(NDC)check</text><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="316" y1="1221.1563" y2="1221.1563"/><line style="stroke: #383838; stroke-width: 1.0;" x1="316" x2="316" y1="1221.1563" y2="1234.1563"/><line style="stroke: #383838; stroke-width: 1.0;" x1="275" x2="316" y1="1234.1563" y2="1234.1563"/><polygon fill="#383838" points="285,1230.1563,275,1234.1563,285,1238.1563,281,1234.1563" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="1214.3223">[20]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="145" x="323" y="1214.3223">Reserve Funds</text><polygon fill="#383838" points="1054,1271.8281,1064,1275.8281,1054,1279.8281,1058,1275.8281" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="1060" y1="1275.8281" y2="1275.8281"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="1268.9941">[21]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="323" y="1268.9941">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="90" x="391" y="1268.9941">/transfers</text><polygon fill="#383838" points="1655,1341.1719,1665,1345.1719,1655,1349.1719,1659,1345.1719" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1071" x2="1661" y1="1345.1719" y2="1345.1719"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1078" y="1324.502">[22]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="260" x="1120" y="1310.666">Create &amp; Reserve Transfer</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="0" x="1126" y="1338.3379"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="1126" y="1338.3379">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="90" x="1194" y="1338.3379">/transfers</text><polygon fill="#383838" points="2102,1382.8438,2112,1386.8438,2102,1390.8438,2106,1386.8438" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1667" x2="2108" y1="1386.8438" y2="1386.8438"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1674" y="1380.0098">[23]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="139" x="1716" y="1380.0098">Reserve funds</text><polygon fill="#383838" points="1678,1424.5156,1668,1428.5156,1678,1432.5156,1674,1428.5156" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1672" x2="2113" y1="1428.5156" y2="1428.5156"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1684" y="1421.6816">[24]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="294" x="1726" y="1421.6816">response (homeTransactionId)</text><polygon fill="#383838" points="1077,1466.1875,1067,1470.1875,1077,1474.1875,1073,1470.1875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1071" x2="1666" y1="1470.1875" y2="1470.1875"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1083" y="1463.3535">[25]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="294" x="1125" y="1463.3535">response (homeTransactionId)</text><line style="stroke: #383838; stroke-width: 1.0;" x1="1066" x2="1108" y1="1511.8594" y2="1511.8594"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1108" x2="1108" y1="1511.8594" y2="1524.8594"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1067" x2="1108" y1="1524.8594" y2="1524.8594"/><polygon fill="#383838" points="1077,1520.8594,1067,1524.8594,1077,1528.8594,1073,1524.8594" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1073" y="1505.0254">[26]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="186" x="1115" y="1505.0254">Generate Fulfilment</text><polygon fill="#383838" points="285,1562.5313,275,1566.5313,285,1570.5313,281,1566.5313" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="279" x2="1065" y1="1566.5313" y2="1566.5313"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="291" y="1559.6973">[27]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="333" y="1559.6973">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="540" x="385" y="1559.6973">/transfers/{id} (TransferStatus='RESERVED', fulfullment)</text><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="316" y1="1608.2031" y2="1608.2031"/><line style="stroke: #383838; stroke-width: 1.0;" x1="316" x2="316" y1="1608.2031" y2="1621.2031"/><line style="stroke: #383838; stroke-width: 1.0;" x1="275" x2="316" y1="1621.2031" y2="1621.2031"/><polygon fill="#383838" points="285,1617.2031,275,1621.2031,285,1625.2031,281,1621.2031" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="1601.3691">[28]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="297" x="323" y="1601.3691">Commit funds in DFSP ledgers</text><polygon fill="#383838" points="1054,1658.875,1064,1662.875,1054,1666.875,1058,1662.875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="1060" y1="1662.875" y2="1662.875"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="1656.041">[29]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="323" y="1656.041">PATCH</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="446" x="406" y="1656.041">/transfers/{id} (TransferStatus='COMMITTED')</text><polygon fill="#383838" points="1655,1755.8906,1665,1759.8906,1655,1763.8906,1659,1759.8906" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1071" x2="1661" y1="1759.8906" y2="1759.8906"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1078" y="1725.3848">[30]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="163" x="1120" y="1697.7129">Commit Transfer</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="0" x="1126" y="1725.3848"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="1126" y="1725.3848">PATCH</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="127" x="1209" y="1725.3848">/transfers/{id}</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="510" x="1120" y="1753.0566">(TransferStatus='COMMITTED', homeTransactionId)</text><polygon fill="#383838" points="2102,1797.5625,2112,1801.5625,2102,1805.5625,2106,1801.5625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1667" x2="2108" y1="1801.5625" y2="1801.5625"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1674" y="1794.7285">[31]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="134" x="1716" y="1794.7285">Commit funds</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2114" x2="2156" y1="1843.2344" y2="1843.2344"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2156" x2="2156" y1="1843.2344" y2="1856.2344"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2115" x2="2156" y1="1856.2344" y2="1856.2344"/><polygon fill="#383838" points="2125,1852.2344,2115,1856.2344,2125,1860.2344,2121,1856.2344" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="2121" y="1836.4004">[32]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="230" x="2163" y="1836.4004">Release funds to Payee</text><polygon fill="#383838" points="1678,1893.9063,1668,1897.9063,1678,1901.9063,1674,1897.9063" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1672" x2="2113" y1="1897.9063" y2="1897.9063"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1684" y="1891.0723">[33]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="89" x="1726" y="1891.0723">response</text><polygon fill="#383838" points="1077,1935.5781,1067,1939.5781,1077,1943.5781,1073,1939.5781" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1071" x2="1666" y1="1939.5781" y2="1939.5781"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1083" y="1932.7441">[34]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="89" x="1125" y="1932.7441">response</text><rect fill="#EEEEEE" filter="url(#f12jdmkq7tu2br)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2458" x="3" y="1974.4141"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2461" y1="1974.4141" y2="1974.4141"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2461" y1="1977.4141" y2="1977.4141"/><rect fill="#EEEEEE" filter="url(#f12jdmkq7tu2br)" height="35.6719" style="stroke: #000000; stroke-width: 2.0;" width="937" x="763.5" y="1957.5781"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="917" x="769.5" y="1984.416">Payee DFSP integration - Quote and Transfer - single AML check &amp; transfer during PATCH</text><polygon fill="#383838" points="1054,2032.9219,1064,2036.9219,1054,2040.9219,1058,2036.9219" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="1060" y1="2036.9219" y2="2036.9219"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="2030.0879">[35]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="323" y="2030.0879">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="71" x="391" y="2030.0879">/quotes</text><polygon fill="#383838" points="285,2074.5938,275,2078.5938,285,2082.5938,281,2078.5938" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="279" x2="1065" y1="2078.5938" y2="2078.5938"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="291" y="2071.7598">[36]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="205" x="333" y="2071.7598">HTTP 202 Response</text><polygon fill="#383838" points="1655,2116.2656,1665,2120.2656,1655,2124.2656,1659,2120.2656" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1071" x2="1661" y1="2120.2656" y2="2120.2656"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1078" y="2113.4316">[37]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="1120" y="2113.4316">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="131" x="1188" y="2113.4316">/quoterequest</text><line style="stroke: #383838; stroke-width: 1.0;" x1="1667" x2="1709" y1="2161.9375" y2="2161.9375"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1709" x2="1709" y1="2161.9375" y2="2174.9375"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1668" x2="1709" y1="2174.9375" y2="2174.9375"/><polygon fill="#383838" points="1678,2170.9375,1668,2174.9375,1678,2178.9375,1674,2174.9375" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1674" y="2155.1035">[38]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="104" x="1716" y="2155.1035">Do nothing</text><polygon fill="#383838" points="1077,2212.6094,1067,2216.6094,1077,2220.6094,1073,2216.6094" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1071" x2="1666" y1="2216.6094" y2="2216.6094"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1083" y="2209.7754">[39]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="98" x="1125" y="2209.7754">Response</text><polygon fill="#383838" points="285,2254.2813,275,2258.2813,285,2262.2813,281,2258.2813" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="279" x2="1065" y1="2258.2813" y2="2258.2813"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="291" y="2251.4473">[40]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="333" y="2251.4473">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="109" x="385" y="2251.4473">/quotes/{Id}</text><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="316" y1="2326.125" y2="2326.125"/><line style="stroke: #383838; stroke-width: 1.0;" x1="316" x2="316" y1="2326.125" y2="2339.125"/><line style="stroke: #383838; stroke-width: 1.0;" x1="275" x2="316" y1="2339.125" y2="2339.125"/><polygon fill="#383838" points="285,2335.125,275,2339.125,285,2343.125,281,2339.125" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="2319.291">[41]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="202" x="323" y="2319.291">Pass Quote to Payer</text><path d="M8,2271.2813 L8,2364.2813 L265,2364.2813 L265,2281.2813 L255,2271.2813 L8,2271.2813 " fill="#ECECEC" filter="url(#f12jdmkq7tu2br)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M255,2271.2813 L255,2281.2813 L265,2281.2813 L255,2271.2813 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="169" x="14" y="2299.1191">Obtain consent to</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="236" x="14" y="2326.791">proceed with the transfer</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="32" x="14" y="2354.4629">Via</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="52" y="2354.4629">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="90" x="120" y="2354.4629">/transfers</text><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="316" y1="2406.9688" y2="2406.9688"/><line style="stroke: #383838; stroke-width: 1.0;" x1="316" x2="316" y1="2406.9688" y2="2419.9688"/><line style="stroke: #383838; stroke-width: 1.0;" x1="275" x2="316" y1="2419.9688" y2="2419.9688"/><polygon fill="#383838" points="285,2415.9688,275,2419.9688,285,2423.9688,281,2419.9688" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="2400.1348">[42]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="273" x="323" y="2400.1348">Perform liquidity(NDC)check</text><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="316" y1="2461.6406" y2="2461.6406"/><line style="stroke: #383838; stroke-width: 1.0;" x1="316" x2="316" y1="2461.6406" y2="2474.6406"/><line style="stroke: #383838; stroke-width: 1.0;" x1="275" x2="316" y1="2474.6406" y2="2474.6406"/><polygon fill="#383838" points="285,2470.6406,275,2474.6406,285,2478.6406,281,2474.6406" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="2454.8066">[43]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="145" x="323" y="2454.8066">Reserve Funds</text><polygon fill="#383838" points="1054,2512.3125,1064,2516.3125,1054,2520.3125,1058,2516.3125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="1060" y1="2516.3125" y2="2516.3125"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="2509.4785">[44]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="323" y="2509.4785">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="90" x="391" y="2509.4785">/transfers</text><polygon fill="#383838" points="1655,2553.9844,1665,2557.9844,1655,2561.9844,1659,2557.9844" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1071" x2="1661" y1="2557.9844" y2="2557.9844"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1078" y="2551.1504">[45]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="1120" y="2551.1504">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="90" x="1188" y="2551.1504">/transfers</text><line style="stroke: #383838; stroke-width: 1.0;" x1="1667" x2="1709" y1="2599.6563" y2="2599.6563"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1709" x2="1709" y1="2599.6563" y2="2612.6563"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1668" x2="1709" y1="2612.6563" y2="2612.6563"/><polygon fill="#383838" points="1678,2608.6563,1668,2612.6563,1678,2616.6563,1674,2612.6563" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1674" y="2592.8223">[46]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="109" x="1716" y="2592.8223">Do Nothing</text><polygon fill="#383838" points="1077,2650.3281,1067,2654.3281,1077,2658.3281,1073,2654.3281" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1071" x2="1666" y1="2654.3281" y2="2654.3281"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1083" y="2647.4941">[47]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="89" x="1125" y="2647.4941">response</text><line style="stroke: #383838; stroke-width: 1.0;" x1="1066" x2="1108" y1="2696" y2="2696"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1108" x2="1108" y1="2696" y2="2709"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1067" x2="1108" y1="2709" y2="2709"/><polygon fill="#383838" points="1077,2705,1067,2709,1077,2713,1073,2709" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1073" y="2689.166">[48]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="186" x="1115" y="2689.166">Generate Fulfilment</text><polygon fill="#383838" points="285,2746.6719,275,2750.6719,285,2754.6719,281,2750.6719" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="279" x2="1065" y1="2750.6719" y2="2750.6719"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="291" y="2743.8379">[49]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="333" y="2743.8379">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="540" x="385" y="2743.8379">/transfers/{id} (TransferStatus='RESERVED', fulfullment)</text><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="274" x2="316" y1="2792.3438" y2="2792.3438"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="316" x2="316" y1="2792.3438" y2="2805.3438"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="275" x2="316" y1="2805.3438" y2="2805.3438"/><polygon fill="#383838" points="285,2801.3438,275,2805.3438,285,2809.3438,281,2805.3438" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="2785.5098">[50]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="297" x="323" y="2785.5098">Commit funds in DFSP ledgers</text><polygon fill="#383838" points="1054,2843.0156,1064,2847.0156,1054,2851.0156,1058,2847.0156" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="1060" y1="2847.0156" y2="2847.0156"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="2840.1816">[51]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="323" y="2840.1816">PATCH</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="446" x="406" y="2840.1816">/transfers/{id} (TransferStatus='COMMITTED')</text><polygon fill="#383838" points="1655,2912.3594,1665,2916.3594,1655,2920.3594,1659,2916.3594" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1071" x2="1661" y1="2916.3594" y2="2916.3594"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1078" y="2895.6895">[52]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="163" x="1120" y="2881.8535">Commit Transfer</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="0" x="1126" y="2909.5254"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="1126" y="2909.5254">PATCH</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="446" x="1209" y="2909.5254">/transfers/{id} (TransferStatus='COMMITTED')</text><polygon fill="#383838" points="2102,2954.0313,2112,2958.0313,2102,2962.0313,2106,2958.0313" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1667" x2="2108" y1="2958.0313" y2="2958.0313"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1674" y="2951.1973">[53]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="381" x="1716" y="2951.1973">Perform AML checks and transfer funds</text><path d="M477,2973.0313 L546,2973.0313 L546,2992.0313 L536,3002.0313 L477,3002.0313 L477,2973.0313 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="587.4219" style="stroke: #000000; stroke-width: 2.0;" width="1928" x="477" y="2973.0313"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="492" y="2996.8691">alt</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="225" x="561" y="2997.8691">[if (AML checks pass)]</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2114" x2="2156" y1="3049.0469" y2="3049.0469"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2156" x2="2156" y1="3049.0469" y2="3062.0469"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2115" x2="2156" y1="3062.0469" y2="3062.0469"/><polygon fill="#383838" points="2125,3058.0469,2115,3062.0469,2125,3066.0469,2121,3062.0469" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="2121" y="3042.2129">[54]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="230" x="2163" y="3042.2129">Release funds to Payee</text><polygon fill="#383838" points="1678,3099.7188,1668,3103.7188,1678,3107.7188,1674,3103.7188" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1672" x2="2113" y1="3103.7188" y2="3103.7188"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1684" y="3096.8848">[55]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="89" x="1726" y="3096.8848">response</text><polygon fill="#383838" points="1082,3141.3906,1072,3145.3906,1082,3149.3906,1078,3145.3906" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1076" x2="1666" y1="3145.3906" y2="3145.3906"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1088" y="3138.5566">[56]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="89" x="1130" y="3138.5566">response</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="477" x2="2405" y1="3154.3906" y2="3154.3906"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="205" x="482" y="3177.2285">[if (AML checks fail)]</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2114" x2="2156" y1="3216.7344" y2="3216.7344"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2156" x2="2156" y1="3216.7344" y2="3229.7344"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2115" x2="2156" y1="3229.7344" y2="3229.7344"/><polygon fill="#383838" points="2125,3225.7344,2115,3229.7344,2125,3233.7344,2121,3229.7344" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="2121" y="3209.9004">[57]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="104" x="2163" y="3209.9004">Do nothing</text><polygon fill="#383838" points="1678,3267.4063,1668,3271.4063,1678,3275.4063,1674,3271.4063" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1672" x2="2113" y1="3271.4063" y2="3271.4063"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1684" y="3264.5723">[58]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="89" x="1726" y="3264.5723">response</text><polygon fill="#383838" points="1082,3309.0781,1072,3313.0781,1082,3317.0781,1078,3313.0781" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1076" x2="1666" y1="3313.0781" y2="3313.0781"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1088" y="3306.2441">[59]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="89" x="1130" y="3306.2441">response</text><rect fill="#ECECEC" filter="url(#f12jdmkq7tu2br)" height="229" style="stroke: #383838; stroke-width: 1.0;" width="569" x="487" y="3326.0781"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="561" x="491" y="3352.916">Payee DFSP AML error checks (and other errors) result in:</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="0" x="497" y="3380.5879"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="201" x="491" y="3408.2598">Reconciliation Error</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="201" x="509" y="3435.9316">Payer has sent funds</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="266" x="509" y="3463.6035">Payer DFSP has sent funds</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="533" x="509" y="3491.2754">Hub considers that the Payee DFSP has received funds</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="395" x="509" y="3518.9473">Payee DFSP has rejected the transaction</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="284" x="509" y="3546.6191">Payee has not received funds</text><rect fill="#EEEEEE" filter="url(#f12jdmkq7tu2br)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2458" x="3" y="3594.2891"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2461" y1="3594.2891" y2="3594.2891"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2461" y1="3597.2891" y2="3597.2891"/><rect fill="#EEEEEE" filter="url(#f12jdmkq7tu2br)" height="35.6719" style="stroke: #000000; stroke-width: 2.0;" width="1007" x="728.5" y="3577.4531"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="987" x="734.5" y="3604.291">Payee DFSP integration - Quote and Transfer - single AML check &amp; transfer during POST transfer</text><polygon fill="#383838" points="1054,3652.7969,1064,3656.7969,1054,3660.7969,1058,3656.7969" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="1060" y1="3656.7969" y2="3656.7969"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="3649.9629">[60]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="323" y="3649.9629">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="71" x="391" y="3649.9629">/quotes</text><polygon fill="#383838" points="285,3694.4688,275,3698.4688,285,3702.4688,281,3698.4688" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="279" x2="1065" y1="3698.4688" y2="3698.4688"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="291" y="3691.6348">[61]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="205" x="333" y="3691.6348">HTTP 202 Response</text><polygon fill="#383838" points="1655,3736.1406,1665,3740.1406,1655,3744.1406,1659,3740.1406" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1071" x2="1661" y1="3740.1406" y2="3740.1406"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1078" y="3733.3066">[62]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="1120" y="3733.3066">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="131" x="1188" y="3733.3066">/quoterequest</text><line style="stroke: #383838; stroke-width: 1.0;" x1="1667" x2="1709" y1="3781.8125" y2="3781.8125"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1709" x2="1709" y1="3781.8125" y2="3794.8125"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1668" x2="1709" y1="3794.8125" y2="3794.8125"/><polygon fill="#383838" points="1678,3790.8125,1668,3794.8125,1678,3798.8125,1674,3794.8125" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1674" y="3774.9785">[63]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="104" x="1716" y="3774.9785">Do nothing</text><polygon fill="#383838" points="1077,3832.4844,1067,3836.4844,1077,3840.4844,1073,3836.4844" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1071" x2="1666" y1="3836.4844" y2="3836.4844"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1083" y="3829.6504">[64]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="98" x="1125" y="3829.6504">Response</text><polygon fill="#383838" points="285,3874.1563,275,3878.1563,285,3882.1563,281,3878.1563" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="279" x2="1065" y1="3878.1563" y2="3878.1563"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="291" y="3871.3223">[65]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="333" y="3871.3223">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="109" x="385" y="3871.3223">/quotes/{Id}</text><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="316" y1="3946" y2="3946"/><line style="stroke: #383838; stroke-width: 1.0;" x1="316" x2="316" y1="3946" y2="3959"/><line style="stroke: #383838; stroke-width: 1.0;" x1="275" x2="316" y1="3959" y2="3959"/><polygon fill="#383838" points="285,3955,275,3959,285,3963,281,3959" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="3939.166">[66]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="202" x="323" y="3939.166">Pass Quote to Payer</text><path d="M8,3891.1563 L8,3984.1563 L265,3984.1563 L265,3901.1563 L255,3891.1563 L8,3891.1563 " fill="#ECECEC" filter="url(#f12jdmkq7tu2br)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M255,3891.1563 L255,3901.1563 L265,3901.1563 L255,3891.1563 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="169" x="14" y="3918.9941">Obtain consent to</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="236" x="14" y="3946.666">proceed with the transfer</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="32" x="14" y="3974.3379">Via</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="52" y="3974.3379">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="90" x="120" y="3974.3379">/transfers</text><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="316" y1="4026.8438" y2="4026.8438"/><line style="stroke: #383838; stroke-width: 1.0;" x1="316" x2="316" y1="4026.8438" y2="4039.8438"/><line style="stroke: #383838; stroke-width: 1.0;" x1="275" x2="316" y1="4039.8438" y2="4039.8438"/><polygon fill="#383838" points="285,4035.8438,275,4039.8438,285,4043.8438,281,4039.8438" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="4020.0098">[67]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="273" x="323" y="4020.0098">Perform liquidity(NDC)check</text><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="316" y1="4081.5156" y2="4081.5156"/><line style="stroke: #383838; stroke-width: 1.0;" x1="316" x2="316" y1="4081.5156" y2="4094.5156"/><line style="stroke: #383838; stroke-width: 1.0;" x1="275" x2="316" y1="4094.5156" y2="4094.5156"/><polygon fill="#383838" points="285,4090.5156,275,4094.5156,285,4098.5156,281,4094.5156" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="4074.6816">[68]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="145" x="323" y="4074.6816">Reserve Funds</text><polygon fill="#383838" points="1054,4132.1875,1064,4136.1875,1054,4140.1875,1058,4136.1875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="1060" y1="4136.1875" y2="4136.1875"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="4129.3535">[69]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="323" y="4129.3535">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="90" x="391" y="4129.3535">/transfers</text><polygon fill="#383838" points="1655,4173.8594,1665,4177.8594,1655,4181.8594,1659,4177.8594" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1071" x2="1661" y1="4177.8594" y2="4177.8594"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1078" y="4171.0254">[70]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="1120" y="4171.0254">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="90" x="1188" y="4171.0254">/transfers</text><polygon fill="#383838" points="2102,4215.5313,2112,4219.5313,2102,4223.5313,2106,4219.5313" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1667" x2="2108" y1="4219.5313" y2="4219.5313"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1674" y="4212.6973">[71]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="381" x="1716" y="4212.6973">Perform AML checks and transfer funds</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2114" x2="2156" y1="4261.2031" y2="4261.2031"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2156" x2="2156" y1="4261.2031" y2="4274.2031"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2115" x2="2156" y1="4274.2031" y2="4274.2031"/><polygon fill="#383838" points="2125,4270.2031,2115,4274.2031,2125,4278.2031,2121,4274.2031" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="2121" y="4254.3691">[72]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="256" x="2163" y="4254.3691">Release of funds to Payee</text><polygon fill="#383838" points="1678,4311.875,1668,4315.875,1678,4319.875,1674,4315.875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1672" x2="2113" y1="4315.875" y2="4315.875"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1684" y="4309.041">[73]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="294" x="1726" y="4309.041">response (homeTransactionId)</text><polygon fill="#383838" points="1077,4353.5469,1067,4357.5469,1077,4361.5469,1073,4357.5469" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1071" x2="1666" y1="4357.5469" y2="4357.5469"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1083" y="4350.7129">[74]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="294" x="1125" y="4350.7129">response (homeTransactionId)</text><line style="stroke: #383838; stroke-width: 1.0;" x1="1066" x2="1108" y1="4399.2188" y2="4399.2188"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1108" x2="1108" y1="4399.2188" y2="4412.2188"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1067" x2="1108" y1="4412.2188" y2="4412.2188"/><polygon fill="#383838" points="1077,4408.2188,1067,4412.2188,1077,4416.2188,1073,4412.2188" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1073" y="4392.3848">[75]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="186" x="1115" y="4392.3848">Generate Fulfilment</text><polygon fill="#383838" points="285,4449.8906,275,4453.8906,285,4457.8906,281,4453.8906" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="279" x2="1065" y1="4453.8906" y2="4453.8906"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="291" y="4447.0566">[76]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="333" y="4447.0566">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="540" x="385" y="4447.0566">/transfers/{id} (TransferStatus='RESERVED', fulfullment)</text><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="316" y1="4495.5625" y2="4495.5625"/><line style="stroke: #383838; stroke-width: 1.0;" x1="316" x2="316" y1="4495.5625" y2="4508.5625"/><line style="stroke: #383838; stroke-width: 1.0;" x1="275" x2="316" y1="4508.5625" y2="4508.5625"/><polygon fill="#383838" points="285,4504.5625,275,4508.5625,285,4512.5625,281,4508.5625" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="4488.7285">[77]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="297" x="323" y="4488.7285">Commit funds in DFSP ledgers</text><path d="M210,4523.5625 L279,4523.5625 L279,4542.5625 L269,4552.5625 L210,4552.5625 L210,4523.5625 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="500.7344" style="stroke: #000000; stroke-width: 2.0;" width="2241" x="210" y="4523.5625"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="225" y="4547.4004">alt</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="360" x="294" y="4548.4004">[if (Transfer status == 'ABORTED')]</text><polygon fill="#383838" points="1054,4595.5781,1064,4599.5781,1054,4603.5781,1058,4599.5781" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="1060" y1="4599.5781" y2="4599.5781"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="4592.7441">[78]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="323" y="4592.7441">PATCH</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="615" x="406" y="4592.7441">/transfers/{id} (TransferStatus='ABORTED', homeTransactionId)</text><polygon fill="#383838" points="1655,4664.9219,1665,4668.9219,1655,4672.9219,1659,4668.9219" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1066" x2="1661" y1="4668.9219" y2="4668.9219"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1073" y="4648.252">[79]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="140" x="1115" y="4634.416">Abort Transfer</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="0" x="1121" y="4662.0879"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="1121" y="4662.0879">PATCH</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="418" x="1204" y="4662.0879">/transfers/{id} (TransferStatus='ABORTED')</text><polygon fill="#383838" points="2102,4706.5938,2112,4710.5938,2102,4714.5938,2106,4710.5938" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1667" x2="2108" y1="4710.5938" y2="4710.5938"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1674" y="4703.7598">[80]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="140" x="1716" y="4703.7598">Abort Transfer</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2114" x2="2156" y1="4752.2656" y2="4752.2656"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2156" x2="2156" y1="4752.2656" y2="4765.2656"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2115" x2="2156" y1="4765.2656" y2="4765.2656"/><polygon fill="#383838" points="2125,4761.2656,2115,4765.2656,2125,4769.2656,2121,4765.2656" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="2121" y="4745.4316">[81]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="276" x="2163" y="4745.4316">Compensate action for abort</text><polygon fill="#383838" points="1678,4802.9375,1668,4806.9375,1678,4810.9375,1674,4806.9375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1672" x2="2113" y1="4806.9375" y2="4806.9375"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1684" y="4800.1035">[82]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="89" x="1726" y="4800.1035">response</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="210" x2="2451" y1="4815.9375" y2="4815.9375"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="383" x="215" y="4838.7754">[if (Transfer status == 'COMMITTED')]</text><polygon fill="#383838" points="1054,4874.2813,1064,4878.2813,1054,4882.2813,1058,4878.2813" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="274" x2="1060" y1="4878.2813" y2="4878.2813"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="281" y="4871.4473">[83]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="323" y="4871.4473">PATCH</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="643" x="406" y="4871.4473">/transfers/{id} (TransferStatus='COMMITTED', homeTransactionId)</text><polygon fill="#383838" points="1655,4915.9531,1665,4919.9531,1655,4923.9531,1659,4919.9531" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1066" x2="1661" y1="4919.9531" y2="4919.9531"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1073" y="4913.1191">[84]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="1115" y="4913.1191">PATCH</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="446" x="1198" y="4913.1191">/transfers/{id} (TransferStatus='COMMITTED')</text><line style="stroke: #383838; stroke-width: 1.0;" x1="1667" x2="1709" y1="4961.625" y2="4961.625"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1709" x2="1709" y1="4961.625" y2="4974.625"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1668" x2="1709" y1="4974.625" y2="4974.625"/><polygon fill="#383838" points="1678,4970.625,1668,4974.625,1678,4978.625,1674,4974.625" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1674" y="4954.791">[85]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="104" x="1716" y="4954.791">Do nothing</text><polygon fill="#383838" points="1077,5012.2969,1067,5016.2969,1077,5020.2969,1073,5016.2969" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1071" x2="1666" y1="5016.2969" y2="5016.2969"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="1083" y="5009.4629">[86]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacingAndGlyphs" textLength="89" x="1125" y="5009.4629">response</text><!--MD5=[0de6dc4568ebdce0778dd9615782a68a]
@startuml Payee DFSP Integration Single Transactional Flow
/'*****
- - - - - - - - - - - - - -
******'/

skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 22
skinparam defaultFontSize 22
skinparam noteFontSize 22
skinparam monochrome true
' declare title
' title Core-Connector transactional flow patterns
' declare actors
participant "Mojaloop\nSwitch" as Switch
box "Payment Manager" #LightGrey
participant "Mojaloop\nConnector" as MC 
participant "Core\nConnector" as CC 
end box
participant "Core banking solution" as CBS
autonumber 1 1 "<b>[0]"

== Payee DFSP integration - Discovery ==

Switch->MC: **GET** /getParty
MC- ->Switch: HTTP 202 Response
MC->CC: **GET** /getParty
activate MC
CC->CBS: **GET** [account lookup]
CBS- ->CC: Response
CC- ->MC: Response
deactivate MC
alt If Success response
MC- ->Switch: **PUT** /parties/{Type}/{Id} (or /parties/{Type}/{Id}/{SubId})
else if Error response
MC- ->Switch: **PUT** /parties/{Type}/{Id}/error (or /parties/{Type}/{Id}/{SubId}/error)
end

== Payee DFSP integration - Quote and Transfer - 2 phase commit with prior AML check ==

Switch->MC: **POST** /quotes
MC- ->Switch: HTTP 202 Response
MC->CC: **POST** /quoterequest
activate MC
CC->CBS: **AML** checks (velocity,etc...)
CBS- ->CC: Response
CC->CBS: **Calculate Fees**
CBS- ->CC: Response
CC- ->MC: Response
deactivate MC
MC- ->Switch: **PUT** /quotes/{Id} 
Switch->Switch: Pass Quote to Payer
note left
Obtain consent to 
proceed with the transfer
Via **POST** /transfers
end note
    Switch-> Switch: Perform liquidity(NDC)check
    Switch->Switch: Reserve Funds
    Switch->MC: **POST** /transfers
    MC->CC: Create & Reserve Transfer\n **POST** /transfers 
    activate MC
    CC->CBS: Reserve funds 
    CBS- ->CC: response (homeTransactionId)
    CC- ->MC: response (homeTransactionId)
    deactivate MC
    MC->MC: Generate Fulfilment
    MC->Switch: **PUT** /transfers/{id} (TransferStatus='RESERVED', fulfullment)
    Switch->Switch: Commit funds in DFSP ledgers
    Switch->MC: **PATCH** /transfers/{id} (TransferStatus='COMMITTED')
    MC->CC: Commit Transfer\n **PATCH** /transfers/{id} \n(TransferStatus='COMMITTED', homeTransactionId) 
    activate MC
    CC->CBS: Commit funds 
    CBS->CBS: Release funds to Payee 
    CBS- ->CC: response
    CC- ->MC: response
    deactivate MC

== Payee DFSP integration - Quote and Transfer - single AML check & transfer during PATCH ==

Switch->MC: **POST** /quotes
MC- ->Switch: HTTP 202 Response
MC->CC: **POST** /quoterequest
activate MC
CC->CC: Do nothing
CC- ->MC: Response
deactivate MC
MC- ->Switch: **PUT** /quotes/{Id} 

Switch->Switch: Pass Quote to Payer
note left
Obtain consent to 
proceed with the transfer
Via **POST** /transfers
end note
    Switch-> Switch: Perform liquidity(NDC)check
    Switch->Switch: Reserve Funds
    Switch->MC: **POST** /transfers
    MC->CC: **POST** /transfers 
    activate MC
    CC->CC: Do Nothing 
    CC- ->MC: response
    deactivate MC
    MC->MC: Generate Fulfilment
    MC- ->Switch: **PUT** /transfers/{id} (TransferStatus='RESERVED', fulfullment)
    Switch- ->Switch: Commit funds in DFSP ledgers

    Switch->MC: **PATCH** /transfers/{id} (TransferStatus='COMMITTED')
    MC->CC: Commit Transfer\n **PATCH** /transfers/{id} (TransferStatus='COMMITTED') 
    activate MC
    CC->CBS: Perform AML checks and transfer funds
    alt if (AML checks pass)
    CBS->CBS: Release funds to Payee 
    CBS- ->CC: response
    CC- ->MC: response
    else if (AML checks fail)
    CBS->CBS: Do nothing
    CBS- ->CC: response
    CC- ->MC: response
    rnote left MC 
    Payee DFSP AML error checks (and other errors) result in:
    
    **Reconciliation Error**
       Payer has sent funds
       Payer DFSP has sent funds
       Hub considers that the Payee DFSP has received funds
       Payee DFSP has rejected the transaction
       Payee has not received funds
    endrnote
    end
    deactivate MC

== Payee DFSP integration - Quote and Transfer - single AML check & transfer during POST transfer ==

Switch->MC: **POST** /quotes
MC- ->Switch: HTTP 202 Response
MC->CC: **POST** /quoterequest
activate MC
CC->CC: Do nothing
CC- ->MC: Response
deactivate MC
MC- ->Switch: **PUT** /quotes/{Id} 

Switch->Switch: Pass Quote to Payer
note left
Obtain consent to 
proceed with the transfer
Via **POST** /transfers
end note
    Switch-> Switch: Perform liquidity(NDC)check
    Switch->Switch: Reserve Funds
    Switch->MC: **POST** /transfers
    MC->CC: **POST** /transfers 
    activate MC
    CC->CBS: Perform AML checks and transfer funds
    CBS->CBS: Release of funds to Payee 
    CBS- ->CC: response (homeTransactionId)
    CC- ->MC: response (homeTransactionId)
    deactivate MC
    MC->MC: Generate Fulfilment
    MC- ->Switch: **PUT** /transfers/{id} (TransferStatus='RESERVED', fulfullment)
    Switch->Switch: Commit funds in DFSP ledgers
    alt if (Transfer status == 'ABORTED')
    Switch->MC: **PATCH** /transfers/{id} (TransferStatus='ABORTED', homeTransactionId)
    MC->CC: Abort Transfer\n **PATCH** /transfers/{id} (TransferStatus='ABORTED')     
    CC->CBS: Abort Transfer
    CBS->CBS: Compensate action for abort
    CBS- ->CC: response
    else if (Transfer status == 'COMMITTED')
    Switch->MC: **PATCH** /transfers/{id} (TransferStatus='COMMITTED', homeTransactionId)
    MC->CC: **PATCH** /transfers/{id} (TransferStatus='COMMITTED') 
    CC->CC: Do nothing
    CC- ->MC: response
    end


@enduml

@startuml Payee DFSP Integration Single Transactional Flow

skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 22
skinparam defaultFontSize 22
skinparam noteFontSize 22
skinparam monochrome true
participant "Mojaloop\nSwitch" as Switch
box "Payment Manager" #LightGrey
participant "Mojaloop\nConnector" as MC 
participant "Core\nConnector" as CC 
end box
participant "Core banking solution" as CBS
autonumber 1 1 "<b>[0]"

== Payee DFSP integration - Discovery ==

Switch->MC: **GET** /getParty
MC- ->Switch: HTTP 202 Response
MC->CC: **GET** /getParty
activate MC
CC->CBS: **GET** [account lookup]
CBS- ->CC: Response
CC- ->MC: Response
deactivate MC
alt If Success response
MC- ->Switch: **PUT** /parties/{Type}/{Id} (or /parties/{Type}/{Id}/{SubId})
else if Error response
MC- ->Switch: **PUT** /parties/{Type}/{Id}/error (or /parties/{Type}/{Id}/{SubId}/error)
end

== Payee DFSP integration - Quote and Transfer - 2 phase commit with prior AML check ==

Switch->MC: **POST** /quotes
MC- ->Switch: HTTP 202 Response
MC->CC: **POST** /quoterequest
activate MC
CC->CBS: **AML** checks (velocity,etc...)
CBS- ->CC: Response
CC->CBS: **Calculate Fees**
CBS- ->CC: Response
CC- ->MC: Response
deactivate MC
MC- ->Switch: **PUT** /quotes/{Id} 
Switch->Switch: Pass Quote to Payer
note left
Obtain consent to 
proceed with the transfer
Via **POST** /transfers
end note
    Switch-> Switch: Perform liquidity(NDC)check
    Switch->Switch: Reserve Funds
    Switch->MC: **POST** /transfers
    MC->CC: Create & Reserve Transfer\n **POST** /transfers 
    activate MC
    CC->CBS: Reserve funds 
    CBS- ->CC: response (homeTransactionId)
    CC- ->MC: response (homeTransactionId)
    deactivate MC
    MC->MC: Generate Fulfilment
    MC->Switch: **PUT** /transfers/{id} (TransferStatus='RESERVED', fulfullment)
    Switch->Switch: Commit funds in DFSP ledgers
    Switch->MC: **PATCH** /transfers/{id} (TransferStatus='COMMITTED')
    MC->CC: Commit Transfer\n **PATCH** /transfers/{id} \n(TransferStatus='COMMITTED', homeTransactionId) 
    activate MC
    CC->CBS: Commit funds 
    CBS->CBS: Release funds to Payee 
    CBS- ->CC: response
    CC- ->MC: response
    deactivate MC

== Payee DFSP integration - Quote and Transfer - single AML check & transfer during PATCH ==

Switch->MC: **POST** /quotes
MC- ->Switch: HTTP 202 Response
MC->CC: **POST** /quoterequest
activate MC
CC->CC: Do nothing
CC- ->MC: Response
deactivate MC
MC- ->Switch: **PUT** /quotes/{Id} 

Switch->Switch: Pass Quote to Payer
note left
Obtain consent to 
proceed with the transfer
Via **POST** /transfers
end note
    Switch-> Switch: Perform liquidity(NDC)check
    Switch->Switch: Reserve Funds
    Switch->MC: **POST** /transfers
    MC->CC: **POST** /transfers 
    activate MC
    CC->CC: Do Nothing 
    CC- ->MC: response
    deactivate MC
    MC->MC: Generate Fulfilment
    MC- ->Switch: **PUT** /transfers/{id} (TransferStatus='RESERVED', fulfullment)
    Switch- ->Switch: Commit funds in DFSP ledgers

    Switch->MC: **PATCH** /transfers/{id} (TransferStatus='COMMITTED')
    MC->CC: Commit Transfer\n **PATCH** /transfers/{id} (TransferStatus='COMMITTED') 
    activate MC
    CC->CBS: Perform AML checks and transfer funds
    alt if (AML checks pass)
    CBS->CBS: Release funds to Payee 
    CBS- ->CC: response
    CC- ->MC: response
    else if (AML checks fail)
    CBS->CBS: Do nothing
    CBS- ->CC: response
    CC- ->MC: response
    rnote left MC 
    Payee DFSP AML error checks (and other errors) result in:
    
    **Reconciliation Error**
       Payer has sent funds
       Payer DFSP has sent funds
       Hub considers that the Payee DFSP has received funds
       Payee DFSP has rejected the transaction
       Payee has not received funds
    endrnote
    end
    deactivate MC

== Payee DFSP integration - Quote and Transfer - single AML check & transfer during POST transfer ==

Switch->MC: **POST** /quotes
MC- ->Switch: HTTP 202 Response
MC->CC: **POST** /quoterequest
activate MC
CC->CC: Do nothing
CC- ->MC: Response
deactivate MC
MC- ->Switch: **PUT** /quotes/{Id} 

Switch->Switch: Pass Quote to Payer
note left
Obtain consent to 
proceed with the transfer
Via **POST** /transfers
end note
    Switch-> Switch: Perform liquidity(NDC)check
    Switch->Switch: Reserve Funds
    Switch->MC: **POST** /transfers
    MC->CC: **POST** /transfers 
    activate MC
    CC->CBS: Perform AML checks and transfer funds
    CBS->CBS: Release of funds to Payee 
    CBS- ->CC: response (homeTransactionId)
    CC- ->MC: response (homeTransactionId)
    deactivate MC
    MC->MC: Generate Fulfilment
    MC- ->Switch: **PUT** /transfers/{id} (TransferStatus='RESERVED', fulfullment)
    Switch->Switch: Commit funds in DFSP ledgers
    alt if (Transfer status == 'ABORTED')
    Switch->MC: **PATCH** /transfers/{id} (TransferStatus='ABORTED', homeTransactionId)
    MC->CC: Abort Transfer\n **PATCH** /transfers/{id} (TransferStatus='ABORTED')     
    CC->CBS: Abort Transfer
    CBS->CBS: Compensate action for abort
    CBS- ->CC: response
    else if (Transfer status == 'COMMITTED')
    Switch->MC: **PATCH** /transfers/{id} (TransferStatus='COMMITTED', homeTransactionId)
    MC->CC: **PATCH** /transfers/{id} (TransferStatus='COMMITTED') 
    CC->CC: Do nothing
    CC- ->MC: response
    end


@enduml

PlantUML version 1.2020.13(Sat Jun 13 13:26:38 BST 2020)
(APACHE source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) Client VM
Default Encoding: Cp1252
Language: en
Country: GB
--></g></svg>